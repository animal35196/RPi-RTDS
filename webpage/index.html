<!DOCTYPE html>
<html lang="en">
    <head>
		<link rel="stylesheet" href="css/styles.css">
        <title>webSockets and Socket.IO</title>
        <script type="text/javascript" src="/socket.io/socket.io.js"></script> 
        <!--The above library(/socket.io/socket.io.js) will be generated by socket.io module of server -->
        <script type="text/javascript" src="js/jquery-3.1.1.js"></script> 
    </head>
	
    <body>
		<div class = 'container'>
			<div id="header"></div>
			<div id="middle">
				<div id="content">
					<div id='title'>RAGE</div>
					<div id='subtitle'>Click to Start</div>
				</div>
				<div id='gameBoard'></div>
				<div id='sidebar'>
					<div id='users' > Users:
						<div id='userlist'> Users here </div>
					</div>
					<div id='chat'> CHAT: 
						<div id='chatlog'></div>
					</div>
					<div>
						<form action="" method="get">
							<input type="text" id="message" style="display:table-cell; width: 100%"/> <!--text form to send data to the server-->
							<input type="submit" id="submit" type="button" style=" display:none; width: 100%" value="Send">
							<div id="response"></div> <!--This is where the data from the server is added-->
						</form>
					</div>
				</div>
			</div>
			<div id="footer"></div>
		</div>
 
        <script type="text/javascript">
			//socket stuff
            var socket = io.connect("192.168.0.50:8080"); 
            /*Initializing the connection with the server via websockets */
            socket.on("message",function(message){  
                /*
                    When server sends data to the client it will trigger "message" event on the client side , by 
                    using socket.on("message") , one cna listen for the ,message event and associate a callback to 
                    be executed . The Callback function gets the dat sent from the server 
                */
                //console.log("Message from the server arrived")
                message = JSON.parse(message);
                console.log(message); /*converting the data into JS object */
				
                $('#chatlog').append('<div style="color:'+message.color+'">'+message.data+'</div>'); /*appending the data on the page using Jquery */
				$('#response').text(message.data);
			});
			
			socket.on('userList',function(data){
				var dataString = '';
				for( var i = 0; i < data.length; i++ ){
					dataString = dataString + '<div style="color: ' + data[i].color + ';">' + data[i].userName + '</div>';
					console.log(dataString);
					}
				document.getElementById('userlist').innerHTML = dataString;
				console.log('userList: ', data);
			});
			
			socket.on('showBoard',function(data){
				$('#title').css('color', data.titleColor);
				$('#content').css('display', data.displayTitle);
				$('#gameBoard').css('display', data.displayGame);
			});

			$('#submit').click(function(){ /*listening to the button click using Jquery listener*/
				var data = { /*creating a Js ojbect to be sent to the server*/ 
					message:$('#message').val(), /*getting the text input data      */             
				}
				socket.send(JSON.stringify(data)); 
				/*Data can be sent to server very easily by using socket.send() method 
				The data has to be changed to a JSON before sending
									  it (JSON.stringify() does this job )*/
				/* This triggers a message event on the server side 
				and the event handler obtains the data sent */ 

				$('#message').val('');
				return false;
			});
			$('#title').click(function(){
				if ( $(this).css('color') == 'rgb(255, 0, 0)'){
					<!-- $(this).css('color', '#00ff00'); -->
					socket.emit('ready', {ready: true});
				} else {
					<!-- $(this).css('color', '#ff0000'); -->
					socket.emit('ready', {ready: false});
				}
				return false;
			});

			var username = prompt('Enter username: ');
			socket.emit('newUser', username);
        </script>
    </body>
</html>
